<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plomberie</title>
  <!-- ::CSS::::::: -->
  <link rel="stylesheet" href="servicepages.css">

  <!-- ::::::cdn icon:::::::: -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- ::::PDF::::::::: -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>

  <!-- Lien  https://html2canvas.hertzen.com/ -->
 <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
 <script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script> -->

 <script >
 </script>


  
</head>
<body>
  

  <!-- ::::::::FORMULAIRE::::::::::: -->
  <div class="wrapper">

    <div class="inner">

      <div class="image-holder">
        <img src="image-services/logo1.png" alt="img">
      </div>

      <form action="">

        <h3>Devis Plomberie</h3>

        <div class="form-group">
          <input type="text" placeholder="Nom destinateur" class="form-control" id="destinateur">
          <input type="text" placeholder="Object" class="form-control" id="objet">
        </div>

        <div class="form-group">
          <input type="text" placeholder="N°: facture" class="form-control" id="numfacture">
          <input type="text" placeholder="Main Œuvres" class="form-control" id="oeuvres">
          <input type="text" placeholder="N°:" class="form-control" id="idt" style="display: none;">
        </div>


        <div class="form-wrapper">
          <input type="text" maxlength="20" placeholder="Désignation" class="form-control" id="Designation">
        </div>

        <div class="form-wrapper">
          <input type="text" min="1" placeholder="Quantité" class="form-control" id="quantite" onchange="calculateMontant()">
        </div>

        <!-- <div class="form-wrapper">
          <select name=""  id="" class="form-control">
            <option value="" disabled selected>Genre</option>
            <option value="homme"  >Homme</option>
            <option value="femme"  >Femme</option>
          </select>
        </div> -->

        <div class="form-wrapper">
          <input type="text" placeholder="Prix Unitaire" class="form-control" id="prixUnitaire" onchange="calculateMontant()">
        </div>

        <div class="form-wrapper">
          <input type="text" placeholder="Montant" class="form-control" id="montant">
        </div>


        <!-- Button Ajouter:::::::::::::: -->
      <a href="#Devis/plomberiefact.html" class="btn" style="text-decoration: none;" value="Add" type="button" onclick="AddRow(); clearFields()">
        AJOUTER 
        <span class="fas fa-chevron-right"></span>
      </a>
     
        
      </form>

    </div>
  </div>

  <!-- :::::::::::::AFFICHAGE DU FORMULAIRE::::::::::::: -->
 <div class="telepdf" id="capture" style="padding: 10px; background: #fff;">

 <div class="traitcontainer">

  <div class="entetepdf">

    <div class="gauche">
      <img src="image-services/logo.png" alt="img">
    </div>

    <div class="milieu">
      <h3>IKA PLOMBIER SARL</h3>
      <h4>RCC : MA BKO.2016.B9400, NIF / 086139811A</h4>
      <p> Halles de Bamako, Bloc Adrar des Ifogas, Magasin 481-482</p>
      <p> <em style="font-weight: bold;">Email:</em> bbarou19860@gmail.com <em style="font-weight: bold;">Tel:</em> 74 24 00 74</p>
    </div>

    <div class="droite">
      <img src="image-services/logo.png" alt="img">
    </div>

  </div>
  <hr style="border: 1px solid #3f0dca; margin-top: 1.5%; margin-bottom: 3%; margin-left: 2%; margin-right: 2%;">


 </div>

  
  <div class="numdoitobjet" style="margin-left: 10%; margin-right: 10%;">
    <h2 class="numfact">FACTURE PRO-FORMAT N° <span></span></h2>
    <div class="doit">DOIT : <span></span></div>
    <div class="objet">OBJET : <span></span></div>
  </div>


  <table id="show">		
    <tr>
        <th>N°:</th>
        <th>DESIGNATION</th>
        <th>QUANTITE</th>
        <th>PRIX UNITAIRE</th>
        <th>MONTANT</th>
    </tr>

</table>

<div class="MainOeuvre" style="display: none;">
  <h2 >Main D'oeuvres : <span> </span> fcfa</h2>
</div>

<div class="montantTTC" style="display: none;">
  <h2 >MontantTTC : <span></span> fcfa</h2>
</div>

<div class="gerantdestinat">
  <div class="gauchedest">Pour accord</div>
  <div class="droitegerant">Le Gérant <p></p></div>
</div>

 </div>


  <button class="btn" id="telecharger" onclick="downloadPDF()">
    Télécharger PDF
  </button>
  <!-- <a href="#Devis" class="btn" id="telecharger" onclick="makePDF()">
    Télécharger PDF 
    <span class="fas fa-chevron-right"></span>
  </a> -->





<!-- :::::::::::::JAVASCRIPT::::::::::::::::::: -->
  <script>
		
    // Déclaration des variables pour tableau
		var list1 = [] ;
		var list2 = [] ;
		var list3 = [] ;
		var list4 = [] ;
		var list5 = [] ;

		var n = 1 ;
		var x = 0 ;
    // var x = 1 ;
    var currentPage = 1;
    var rowsPerPage = 20;
    var pdfPages = [];


    // Calcul Prix Unitaire * Quantité
    function calculateMontant() {
    var quantite = document.getElementById("quantite").value;
    var prixUnitaire = document.getElementById("prixUnitaire").value;
    var montant = quantite * prixUnitaire;
    document.getElementById("montant").value = montant;
}


    // Ajout ligne automatiquement
		function AddRow(){

        // Incrémation id à chaque ajout(id="idt")
        var id = document.getElementById("idt").value;
        id++; // Incrémente la valeur de l'ID
        document.getElementById("idt").value = id;

        // Tableau
			var AddRown = document.getElementById(`show`) ;
			var NewRow = AddRown.insertRow(n);

      // Récupération des données input les ("id")
			list1[x] = document.getElementById("idt").value ;
			list2[x] = document.getElementById("Designation").value ;
			list3[x] = document.getElementById("quantite").value ;
			list4[x] = document.getElementById("prixUnitaire").value ;
			list5[x] = document.getElementById("montant").value ;

      // Insertion de nouveau ligne à chaque clique sur boutton
      var cel1 = NewRow.insertCell(0) ;
      var cel2 = NewRow.insertCell(1) ;
      var cel3 = NewRow.insertCell(2) ;
      var cel4 = NewRow.insertCell(3) ;
      var cel5 = NewRow.insertCell(4) ;

      cel1.innerHTML = list1[x] ;
      cel2.innerHTML = list2[x] ;
      cel3.innerHTML = list3[x] ;
      cel4.innerHTML = list4[x] ;
      cel5.innerHTML = list5[x] ;

      n++ ;
      x++ ;

        // Vérifier si le nombre de lignes atteint 20 pour créer de nouvelles pages PDF
        if (n % rowsPerPage === 0) {
        createPDFPages();
      }

      calculateTotalAmount();

		}


    
    // Fonction Récupérer Automatique input Facture::::::::::::::::::::::
    function recupererNumFacture() {
    var numFactureInput = document.getElementById("numfacture");
    var numFactureSpan = document.querySelector(".numfact");

   if (numFactureInput.value.trim() !== "") {
    numFactureSpan.querySelector("span").textContent = numFactureInput.value;
  }
}
  // Récupération automatique lorsqu'un changement est apporté à l'élément "numfacture"
  var numFactureInput = document.getElementById("numfacture");
  numFactureInput.addEventListener("input", recupererNumFacture);



    // Fonction Récupérer Automatique input (objet):::::::::::::::::::::::::::::
    function recupererObjet() {
    var objetInput = document.getElementById("objet");
    var objetSpan = document.querySelector(".objet");

  if (objetInput.value.trim() !== "") {
    objetSpan.querySelector("span").textContent = objetInput.value;
  }
}
// Récupération automatique lorsqu'un changement est apporté à l'élément "objet"
var objetInput = document.getElementById("objet");
objetInput.addEventListener("input", recupererObjet);



  // Fonction Récupérer Automatique input destinateur:::::::::::::::::::::::::::
  function recupererDestinateur() {
  var destinateurInput = document.getElementById("destinateur");
  var doitSpan = document.querySelector(".doit");
  if (destinateurInput.value.trim() !== "") {
    doitSpan.querySelector("span").textContent = destinateurInput.value;
  }
}
// Récupération automatique lorsqu'un changement est apporté à l'élément "destinateur"
var destinateurInput = document.getElementById("destinateur");
destinateurInput.addEventListener("input", recupererDestinateur);




    // Fonction Récupérer Automatique input Main d'oeuvres:::::::::::::::::::::::::::
    var mainOeuvreInput = document.getElementById("oeuvres");
    var mainOeuvreSpan = document.querySelector(".MainOeuvre");

    mainOeuvreInput.addEventListener("input", function() {
      if (mainOeuvreInput.value.trim() !== "") {
        mainOeuvreSpan.style.display = "block";
        mainOeuvreSpan.querySelector("span").textContent = mainOeuvreInput.value;
      } else {
        mainOeuvreSpan.style.display = "none";
      }
    });



    // Fonction de la Somme total 
  // Calculer le montant total
  function calculateTotalAmount() {
    var table = document.getElementById("show");
    var total = 0;

    for (var i = 1; i < table.rows.length; i++) {
      var cellValue = table.rows[i].cells[4].innerHTML.trim();
      if (cellValue !== "") {
        total += parseFloat(cellValue);
      }
    }

    var montantTTCElement = document.querySelector(".montantTTC span");

    if (total === 0) {
      montantTTCElement.textContent = ""; // Efface le contenu du span
      document.querySelector(".montantTTC").style.display = "none"; // Masque l'élément
    } else {
      montantTTCElement.textContent = total;
      document.querySelector(".montantTTC").style.display = "block"; // Affiche l'élément
    }
  }

  // Fonction pour vider les differents champs::::::::::::::::::::
  function clearFields() {
  document.getElementById("Designation").value = "";
  document.getElementById("quantite").value = "";
  document.getElementById("prixUnitaire").value = "";
  document.getElementById("montant").value = "";
}


// Fonction qui prend automatiquement la date du jour:::::::::::::::::::::
function ajouterDateDuJour() {
  var dateDuJour = new Date();
  var options = { year: 'numeric', month: 'numeric', day: 'numeric' };
  var dateFormatee = dateDuJour.toLocaleDateString('fr-FR', options);
  var paragraphe = document.querySelector('.droitegerant > p');
  paragraphe.textContent = dateFormatee;
}
ajouterDateDuJour();


// FAIRE DISPARAITRE TOUT LE CONTENU DU (class="telepdf" et class="telecharger"):::::::::::::::: :::::::::::::::::::::::::::::
// Fonction pour vérifier si des événements ont eu lieu sur les inputs
function verifierEvenements() {
  var inputs = document.getElementsByTagName("input");
  var telechargerElement = document.getElementById("telecharger");
  var telepdfElements = document.getElementsByClassName("telepdf");

  // Vérifier si au moins un input a une valeur
  var evenementDetecte = false;
  for (var i = 0; i < inputs.length; i++) {
    if (inputs[i].value.trim() !== "") {
      evenementDetecte = true;
      break;
    }
  }

  // Modifier la visibilité des éléments en fonction des événements détectés
  if (evenementDetecte) {
    telechargerElement.style.display = "block";
    for (var j = 0; j < telepdfElements.length; j++) {
      telepdfElements[j].style.display = "block";
    }
  } else {
    telechargerElement.style.display = "none";
    for (var k = 0; k < telepdfElements.length; k++) {
      telepdfElements[k].style.display = "none";
    }
  }
}

// Appeler la fonction pour vérifier les événements à chaque modification d'un input
var inputs = document.getElementsByTagName("input");
for (var i = 0; i < inputs.length; i++) {
  inputs[i].addEventListener("input", verifierEvenements);
}
// Appeler la fonction une première fois pour initialiser la visibilité des éléments
verifierEvenements();




// :::::::::::::FUNCTION PDF TELECHARGEMENT::::::::::::::::::::::
  window.html2canvas = html2canvas;
  window.jsPDF = window.jspdf.jsPDF;
  function makePDF(){

    html2canvas(document.querySelector("#capture"),{

      allowTaint:true,
      useCORS: true,
      scale: 1
    }).then(canvas => {
      // document.body.appendChild(canvas)
      var img = canvas.toDataURL("image/png");

      var doc = new jsPDF();
      doc.setFont('Arial');
      doc.getFontSize(11);
      doc.addImage(img,'PNG',7,13,195,105);
      doc.save("plomberie");
    });
  }


  // ::::::::::::A EFFACE::::::::::::::::::
  function createPDFPages() {
      // Générer une nouvelle page PDF
      var pdf = new jsPDF();

      // Ajouter les lignes de la table à la page PDF actuelle
      var startRow = (currentPage - 1) * rowsPerPage;
      var endRow = startRow + rowsPerPage;
      for (var i = startRow; i < endRow; i++) {
        if (i >= list1.length) break; // Arrêter si toutes les lignes ont été ajoutées
        pdf.text(10, (i % rowsPerPage + 1) * 10, `${list1[i]} ${list2[i]} ${list3[i]} ${list4[i]} ${list5[i]}`);
      }

      // Ajouter la page PDF à la liste des pages
      pdfPages.push(pdf);

      // Incrémenter le numéro de page actuelle
      currentPage++;
    }

    function downloadPDF() {
    var element = document.getElementById("capture");
    html2canvas(element).then(function(canvas) {
    var pdf = new jsPDF();
    pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
    pdf.save("plombier.pdf");
  });
}




	</script>
<!-- <button onclick="makePDF()"> MakePDF</button> -->
 
</body>
</html>